<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Natro Macro - Search Tool</title>
    <meta name="description" content="Buscador interactivo de comandos para Natro Macro - Bee Swarm Simulator">
    
    <style>
        /* =========================================
           VARIABLES Y RESET
           ========================================= */
        :root {
            /* Tema Oscuro (Por defecto) */
            --bg-body: #0f0f0f;
            --bg-card: #1e1e1e;
            --bg-input: #2d2d2d;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --accent: #00ff9d; /* Verde Ne√≥n */
            --accent-hover: #00cc7d;
            --accent-text: #0f0f0f;
            --border: #333333;
            --highlight: rgba(0, 255, 157, 0.3);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --toast-bg: #333;
            --font-main: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            --font-mono: 'Consolas', 'Monaco', 'Courier New', monospace;
            
            /* AI Feature Colors */
            --ai-gradient: linear-gradient(135deg, #00ff9d 0%, #00b8ff 100%);
            --ai-bg: #1a2733;
        }

        [data-theme="light"] {
            /* Tema Claro */
            --bg-body: #f4f6f8;
            --bg-card: #ffffff;
            --bg-input: #eef2f5;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --accent: #2b6cb0; /* Azul s√≥lido */
            --accent-hover: #2c5282;
            --accent-text: #ffffff;
            --border: #e2e8f0;
            --highlight: rgba(43, 108, 176, 0.2);
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            --toast-bg: #2d3748;
            --ai-bg: #e6f7ff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s ease, color 0.2s ease, border-color 0.3s ease;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-body);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* =========================================
           LAYOUT Y COMPONENTES
           ========================================= */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
            gap: 15px;
        }

        .header-text h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 5px;
        }

        .header-text p {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-outline {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .btn-outline:hover {
            border-color: var(--accent);
        }
        
        .lang-toggle {
            min-width: 60px;
            justify-content: center;
            font-family: var(--font-mono);
        }

        /* AI Button */
        .ai-btn {
            background: var(--ai-gradient);
            border: none;
            color: #000;
            padding: 8px 20px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            font-weight: 700;
            box-shadow: 0 0 15px rgba(0, 255, 157, 0.3);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .ai-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(0, 255, 157, 0.5);
        }

        /* Buscador */
        .search-container {
            position: relative;
            margin-bottom: 25px;
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            width: 20px;
            height: 20px;
        }

        .search-input {
            width: 100%;
            padding: 16px 50px;
            font-size: 1.1rem;
            background-color: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            outline: none;
            box-shadow: var(--shadow);
        }

        .search-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--highlight);
        }

        .clear-btn {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            display: none; /* Hidden by default */
            padding: 5px;
        }

        .clear-btn:hover {
            color: var(--text-primary);
        }

        /* Filtros */
        .filters {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 15px;
            margin-bottom: 20px;
            scrollbar-width: thin;
            scrollbar-color: var(--border) transparent;
        }

        .filters::-webkit-scrollbar {
            height: 6px;
        }
        .filters::-webkit-scrollbar-thumb {
            background-color: var(--border);
            border-radius: 3px;
        }

        .filter-btn {
            background-color: var(--bg-card);
            color: var(--text-secondary);
            border: 1px solid var(--border);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            white-space: nowrap;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .filter-btn:hover {
            border-color: var(--accent);
            color: var(--text-primary);
        }

        .filter-btn.active {
            background-color: var(--accent);
            color: var(--accent-text);
            border-color: var(--accent);
            font-weight: 700;
        }

        /* Resultados Info */
        .results-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Grid de Cartas */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .card {
            background-color: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }

        .card.ai-result {
            border: 1px solid var(--accent);
            background-color: var(--ai-bg);
        }

        .card:hover {
            transform: translateY(-2px);
            border-color: var(--accent);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 10px;
        }

        .badge {
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 6px;
            background-color: var(--bg-input);
            color: var(--text-secondary);
            border: 1px solid var(--border);
            white-space: nowrap;
        }

        .badge.ai-badge {
            background: var(--accent);
            color: #000;
            font-weight: bold;
        }

        .command-text {
            font-family: var(--font-mono);
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--accent);
            word-break: break-word;
        }

        .card-desc {
            color: var(--text-secondary);
            font-size: 0.95rem;
            flex-grow: 1;
        }

        .copy-btn {
            align-self: flex-start;
            background-color: transparent;
            border: 1px solid var(--border);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 10px;
            width: 100%;
            justify-content: center;
        }

        .copy-btn:hover {
            background-color: var(--bg-input);
            border-color: var(--text-secondary);
        }

        .copy-btn svg {
            width: 16px;
            height: 16px;
        }

        /* Estado vac√≠o */
        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .highlight-text {
            background-color: var(--highlight);
            color: inherit;
            border-radius: 2px;
            padding: 0 2px;
        }

        /* Toast Notificaci√≥n */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background-color: var(--toast-bg);
            color: #fff;
            padding: 12px 24px;
            border-radius: 50px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* SVG Icons Inline */
        .icon {
            display: inline-block;
            fill: currentColor;
        }

        /* =========================================
           AI MODAL STYLES
           ========================================= */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal-overlay.open {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: var(--bg-card);
            width: 90%;
            max-width: 600px;
            border-radius: 16px;
            border: 1px solid var(--border);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            padding: 30px;
            position: relative;
            transform: translateY(20px);
            transition: transform 0.3s ease;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .modal-overlay.open .modal-content {
            transform: translateY(0);
        }

        .modal-header h2 {
            font-size: 1.5rem;
            color: var(--accent);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-close:hover { color: var(--text-primary); }

        .ai-input-area {
            margin-top: 10px;
        }

        .ai-textarea {
            width: 100%;
            background: var(--bg-input);
            border: 2px solid var(--border);
            color: var(--text-primary);
            padding: 15px;
            border-radius: 12px;
            font-family: var(--font-main);
            font-size: 1rem;
            resize: vertical;
            min-height: 100px;
            margin-bottom: 15px;
        }

        .ai-textarea:focus {
            border-color: var(--accent);
            outline: none;
        }

        .ai-submit-btn {
            width: 100%;
            background: var(--accent);
            color: var(--accent-text);
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .ai-submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .ai-results {
            margin-top: 20px;
            overflow-y: auto;
            flex-grow: 1;
            display: none; /* Hidden until results */
        }
        
        .ai-results.has-results {
            display: block;
            border-top: 1px solid var(--border);
            padding-top: 20px;
        }

        .loading-spinner {
            display: none;
            text-align: center;
            margin: 20px 0;
        }

        .spinner {
            width: 30px;
            height: 30px;
            border: 4px solid var(--bg-input);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* Footer */
        footer {
            margin-top: 50px;
            text-align: center;
            padding: 20px;
            border-top: 1px solid var(--border);
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        /* Responsive Mobile tweaks */
        @media (max-width: 600px) {
            .header-text h1 { font-size: 1.5rem; }
            .grid-container { grid-template-columns: 1fr; }
            .search-input { font-size: 1rem; padding: 14px 45px; }
            .header-actions { width: 100%; justify-content: flex-start; margin-top: 10px; }
            .ai-btn { flex-grow: 1; justify-content: center; }
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- HEADER -->
        <header>
            <div class="header-text">
                <h1 data-i18n="title">Natro Macro - Comandos</h1>
                <p data-i18n="subtitle">Busca comandos, configuraciones y par√°metros para Bee Swarm Simulator.</p>
            </div>
            <div class="header-actions">
                <button class="ai-btn" id="openAIModal" data-i18n="aiBtn">
                    ‚ú® Asistente IA
                </button>
                <button class="btn-outline lang-toggle" id="langToggle" aria-label="Cambiar idioma">
                    ES
                </button>
                <button class="btn-outline theme-toggle" id="themeToggle" aria-label="Cambiar tema">
                    <!-- Icon Sun -->
                    <svg class="icon icon-sun" style="display:none;" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                    <!-- Icon Moon -->
                    <svg class="icon icon-moon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                </button>
            </div>
        </header>

        <!-- SEARCH -->
        <div class="search-container">
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            <input type="text" class="search-input" id="searchInput" data-i18n-placeholder="searchPlaceholder" placeholder="Busca por comando, descripci√≥n o palabra clave..." autocomplete="off">
            <button class="clear-btn" id="clearBtn" title="Limpiar b√∫squeda">‚úï</button>
        </div>

        <!-- FILTERS -->
        <div class="filters" id="filtersContainer">
            <button class="filter-btn active" data-category="all" data-i18n="filterAll">Todas</button>
            <button class="filter-btn" data-category="Gather Tab">Gather</button>
            <button class="filter-btn" data-category="Collect Tab">Collect</button>
            <button class="filter-btn" data-category="Kill Tab">Kill</button>
            <button class="filter-btn" data-category="Boost Tab">Boost</button>
            <button class="filter-btn" data-category="Planters+ Tab">Planters</button>
            <button class="filter-btn" data-category="Quest Tab">Quest</button>
            <button class="filter-btn" data-category="Status Tab">Status</button>
            <button class="filter-btn" data-category="Settings Tab">Settings</button>
            <button class="filter-btn" data-category="Other Commands" data-i18n="filterOther">Otros</button>
        </div>

        <!-- INFO BAR -->
        <div class="results-info">
            <span id="resultCount">Mostrando todos los comandos</span>
        </div>

        <!-- RESULTS GRID -->
        <div class="grid-container" id="resultsGrid">
            <!-- Cards will be injected here via JS -->
        </div>

        <footer>
            <p data-i18n="footer">Natro Macro Search Tool v1.2</p>
        </footer>
    </div>

    <!-- AI MODAL -->
    <div class="modal-overlay" id="aiModal">
        <div class="modal-content">
            <button class="modal-close" id="closeAIModal">√ó</button>
            <div class="modal-header">
                <h2 data-i18n="aiModalTitle">‚ú® Asistente de Estrategia</h2>
                <p style="color: var(--text-secondary); font-size: 0.9rem;" data-i18n="aiModalSubtitle">
                    Describe tu objetivo y la IA generar√° la configuraci√≥n √≥ptima.
                </p>
            </div>
            
            <div class="ai-input-area">
                <textarea class="ai-textarea" id="aiPrompt" data-i18n-placeholder="aiPlaceholder" placeholder="Ej: Soy hive azul nivel 15. Quiero farmear blueberries..."></textarea>
                <button class="ai-submit-btn" id="aiSubmitBtn" data-i18n="aiSubmit">Generar Configuraci√≥n</button>
            </div>

            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner"></div>
                <p data-i18n="aiLoading">Analizando estrategia...</p>
            </div>

            <div class="ai-results" id="aiResults">
                <!-- AI Generated cards go here -->
            </div>
        </div>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div class="toast" id="toast">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
        <span data-i18n="toast">¬°Comando copiado!</span>
    </div>

    <script>
        // =========================================
        // GEMINI API CONFIG
        // =========================================
        const apiKey = ""; // La clave se inyecta en tiempo de ejecuci√≥n

        // =========================================
        // LOCALIZATION DATA
        // =========================================
        const translations = {
            es: {
                title: "Natro Macro - Comandos",
                subtitle: "Busca comandos, configuraciones y par√°metros para Bee Swarm Simulator.",
                searchPlaceholder: "Busca por comando, descripci√≥n o palabra clave...",
                filterAll: "Todas",
                filterOther: "Otros",
                aiBtn: "‚ú® Asistente IA",
                aiModalTitle: "‚ú® Asistente de Estrategia",
                aiModalSubtitle: "Describe tu objetivo y la IA generar√° la configuraci√≥n √≥ptima.",
                aiPlaceholder: "Ej: Soy hive azul nivel 15. Quiero farmear blueberries en el campo de bamb√∫...",
                aiSubmit: "Generar Configuraci√≥n",
                aiLoading: "Analizando estrategia...",
                aiRecommendedBadge: "Recomendado por IA",
                aiStrategyLabel: "Estrategia:",
                copyBtn: "Copiar comando",
                toast: "¬°Comando copiado!",
                emptyTitle: "No se encontraron resultados",
                emptyDesc: "Intenta con otra palabra clave o cambia la categor√≠a.",
                footer: "Natro Macro Search Tool v1.2",
                countAll: "Mostrando todos los comandos",
                countFound: "Encontrados:",
                cmdLabel: "comando",
                cmdsLabel: "comandos"
            },
            en: {
                title: "Natro Macro - Commands",
                subtitle: "Search for commands, settings, and parameters for Bee Swarm Simulator.",
                searchPlaceholder: "Search by command, description, or keyword...",
                filterAll: "All",
                filterOther: "Others",
                aiBtn: "‚ú® AI Assistant",
                aiModalTitle: "‚ú® Strategy Assistant",
                aiModalSubtitle: "Describe your goal and AI will generate the optimal configuration.",
                aiPlaceholder: "Ex: I am a level 15 blue hive. I want to farm blueberries in Bamboo field...",
                aiSubmit: "Generate Config",
                aiLoading: "Analyzing strategy...",
                aiRecommendedBadge: "AI Recommended",
                aiStrategyLabel: "Strategy:",
                copyBtn: "Copy command",
                toast: "Command copied!",
                emptyTitle: "No results found",
                emptyDesc: "Try another keyword or change the category.",
                footer: "Natro Macro Search Tool v1.2",
                countAll: "Showing all commands",
                countFound: "Found:",
                cmdLabel: "command",
                cmdsLabel: "commands"
            }
        };

        // =========================================
        // DATOS (Comandos) - Bilingual
        // =========================================
        const comandos = [
            // GATHER TAB
            { comando: "?set FieldName1 (Field)", descripcion: "Establece el campo principal de recolecci√≥n.", descripcion_en: "Sets the primary gathering field.", categoria: "Gather Tab" },
            { comando: "?set FieldName2 (Field)", descripcion: "Establece el campo secundario para rotaci√≥n.", descripcion_en: "Sets the secondary field for rotation.", categoria: "Gather Tab" },
            { comando: "?set FieldName3 (Field)", descripcion: "Establece el tercer campo para rotaci√≥n.", descripcion_en: "Sets the third field for rotation.", categoria: "Gather Tab" },
            { comando: "?set FieldName4 (Field)", descripcion: "Establece el cuarto campo para rotaci√≥n.", descripcion_en: "Sets the fourth field for rotation.", categoria: "Gather Tab" },
            { comando: "?set Pattern (Pattern)", descripcion: "Cambia el patr√≥n de movimiento de recolecci√≥n.", descripcion_en: "Changes the gathering movement pattern.", categoria: "Gather Tab" },
            { comando: "?set RotateFields (bool)", descripcion: "Activa o desactiva la rotaci√≥n entre campos.", descripcion_en: "Enables or disables field rotation.", categoria: "Gather Tab" },
            
            // COLLECT TAB
            { comando: "?set ConvertBalloon (bool)", descripcion: "Convierte en la colmena si el globo est√° lleno.", descripcion_en: "Converts at hive if balloon is full.", categoria: "Collect Tab" },
            { comando: "?set MstDispenser (bool)", descripcion: "Activa/Desactiva el uso del dispensador MST.", descripcion_en: "Enables/Disables MST dispenser usage.", categoria: "Collect Tab" },
            { comando: "?set Clock (bool)", descripcion: "Usa el Wealth Clock cada hora.", descripcion_en: "Uses the Wealth Clock every hour.", categoria: "Collect Tab" },
            
            // KILL TAB
            { comando: "?set EnableVicious (bool)", descripcion: "Activa la caza de Vicious Bee.", descripcion_en: "Enables Vicious Bee hunting.", categoria: "Kill Tab" },
            { comando: "?set EnableWindy (bool)", descripcion: "Activa la caza de Windy Bee.", descripcion_en: "Enables Windy Bee hunting.", categoria: "Kill Tab" },
            { comando: "?set EnableMondo (bool)", descripcion: "Activa la caza de Mondo Chick.", descripcion_en: "Enables Mondo Chick hunting.", categoria: "Kill Tab" },
            { comando: "?set EnableAnt (bool)", descripcion: "Realiza el Ant Challenge autom√°ticamente.", descripcion_en: "Runs Ant Challenge automatically.", categoria: "Kill Tab" },
            
            // BOOST TAB
            { comando: "?set BlueExtract (bool)", descripcion: "Usa extracto azul autom√°ticamente.", descripcion_en: "Uses Blue Extract automatically.", categoria: "Boost Tab" },
            { comando: "?set RedExtract (bool)", descripcion: "Usa extracto rojo autom√°ticamente.", descripcion_en: "Uses Red Extract automatically.", categoria: "Boost Tab" },
            { comando: "?set Glitter (bool)", descripcion: "Usa Glitter en el campo.", descripcion_en: "Uses Glitter in the field.", categoria: "Boost Tab" },
            { comando: "?set Glue (bool)", descripcion: "Usa Glue en el campo.", descripcion_en: "Uses Glue in the field.", categoria: "Boost Tab" },
            { comando: "?set Oil (bool)", descripcion: "Usa Oil en el campo.", descripcion_en: "Uses Oil in the field.", categoria: "Boost Tab" },
            
            // PLANTERS TAB
            { comando: "?set Planter1 (Planter)", descripcion: "Asigna la maceta para la ranura 1.", descripcion_en: "Sets the planter for slot 1.", categoria: "Planters+ Tab" },
            { comando: "?set Planter2 (Planter)", descripcion: "Asigna la maceta para la ranura 2.", descripcion_en: "Sets the planter for slot 2.", categoria: "Planters+ Tab" },
            { comando: "?set Planter3 (Planter)", descripcion: "Asigna la maceta para la ranura 3.", descripcion_en: "Sets the planter for slot 3.", categoria: "Planters+ Tab" },
            
            // QUEST TAB
            { comando: "?set EnableQuests (bool)", descripcion: "Habilita o deshabilita el sistema de misiones.", descripcion_en: "Enables or disables the quest system.", categoria: "Quest Tab" },
            { comando: "?set PolarPower (bool)", descripcion: "Prioriza misiones de Polar Bear.", descripcion_en: "Prioritizes Polar Bear quests.", categoria: "Quest Tab" },
            { comando: "?set BlackBear (bool)", descripcion: "Prioriza misiones de Black Bear.", descripcion_en: "Prioritizes Black Bear quests.", categoria: "Quest Tab" },
            
            // STATUS TAB
            { comando: "?status", descripcion: "Muestra el estado actual del macro.", descripcion_en: "Shows current macro status.", categoria: "Status Tab" },
            { comando: "?version", descripcion: "Muestra la versi√≥n de Natro Macro instalada.", descripcion_en: "Shows installed Natro Macro version.", categoria: "Status Tab" },
            { comando: "?stats", descripcion: "Muestra estad√≠sticas de recolecci√≥n de la sesi√≥n.", descripcion_en: "Shows gathering session statistics.", categoria: "Status Tab" },
            
            // SETTINGS TAB
            { comando: "?set ReconnectTime (mins)", descripcion: "Tiempo de espera antes de reconectar.", descripcion_en: "Wait time before reconnecting.", categoria: "Settings Tab" },
            { comando: "?set WalkSpeed (number)", descripcion: "Ajusta la velocidad de caminata del personaje.", descripcion_en: "Adjusts character walk speed.", categoria: "Settings Tab" },
            { comando: "?set MoveMethod (method)", descripcion: "Cambia m√©todo de movimiento (Canon/Walk).", descripcion_en: "Changes movement method (Canon/Walk).", categoria: "Settings Tab" },
            { comando: "?set PrivateServer (link)", descripcion: "Establece el enlace del servidor privado.", descripcion_en: "Sets the private server link.", categoria: "Settings Tab" },
            
            // OTHER COMMANDS
            { comando: "?pause", descripcion: "Pausa el macro temporalmente.", descripcion_en: "Pauses the macro temporarily.", categoria: "Other Commands" },
            { comando: "?resume", descripcion: "Reanuda el macro si estaba pausado.", descripcion_en: "Resumes the macro if paused.", categoria: "Other Commands" },
            { comando: "?stop", descripcion: "Detiene el macro completamente.", descripcion_en: "Stops the macro completely.", categoria: "Other Commands" },
            { comando: "?reset", descripcion: "Reinicia el personaje en el juego.", descripcion_en: "Resets the character in-game.", categoria: "Other Commands" }
        ];

        // =========================================
        // L√ìGICA Y ESTADO
        // =========================================
        
        // Elementos DOM
        const searchInput = document.getElementById('searchInput');
        const clearBtn = document.getElementById('clearBtn');
        const resultsGrid = document.getElementById('resultsGrid');
        const resultCount = document.getElementById('resultCount');
        const filtersContainer = document.getElementById('filtersContainer');
        const themeToggle = document.getElementById('themeToggle');
        const langToggle = document.getElementById('langToggle');
        const toast = document.getElementById('toast');
        const iconSun = document.querySelector('.icon-sun');
        const iconMoon = document.querySelector('.icon-moon');
        
        // AI DOM Elements
        const openAIModalBtn = document.getElementById('openAIModal');
        const aiModal = document.getElementById('aiModal');
        const closeAIModalBtn = document.getElementById('closeAIModal');
        const aiPromptInput = document.getElementById('aiPrompt');
        const aiSubmitBtn = document.getElementById('aiSubmitBtn');
        const aiResultsContainer = document.getElementById('aiResults');
        const loadingSpinner = document.getElementById('loadingSpinner');

        // Estado inicial
        let currentFilter = 'all';
        let searchTerm = '';
        let theme = localStorage.getItem('theme') || 'dark';
        let currentLang = localStorage.getItem('lang') || 'es';

        // =========================================
        // FUNCIONES CORE
        // =========================================

        function init() {
            applyTheme(theme);
            applyLanguage(currentLang);
            
            // Event Listeners Search
            searchInput.addEventListener('input', handleSearch);
            clearBtn.addEventListener('click', clearSearch);
            filtersContainer.addEventListener('click', handleFilterClick);
            themeToggle.addEventListener('click', toggleTheme);
            langToggle.addEventListener('click', toggleLanguage);
            
            // Event Listeners AI
            openAIModalBtn.addEventListener('click', openModal);
            closeAIModalBtn.addEventListener('click', closeModal);
            aiModal.addEventListener('click', (e) => {
                if (e.target === aiModal) closeModal();
            });
            aiSubmitBtn.addEventListener('click', handleAIRequest);
            
            // Atajos de teclado
            document.addEventListener('keydown', (e) => {
                if (e.key === '/' && !aiModal.classList.contains('open')) {
                    e.preventDefault();
                    searchInput.focus();
                }
                if (e.key === 'Escape') {
                    if (aiModal.classList.contains('open')) {
                        closeModal();
                    } else {
                        clearSearch();
                        searchInput.blur();
                    }
                }
            });
        }

        // --- Localization ---
        function toggleLanguage() {
            currentLang = currentLang === 'es' ? 'en' : 'es';
            localStorage.setItem('lang', currentLang);
            applyLanguage(currentLang);
        }

        function applyLanguage(lang) {
            // Update Toggle Button Text
            langToggle.textContent = lang.toUpperCase();
            
            // Update Static Texts
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });

            // Update Placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                if (translations[lang][key]) {
                    el.placeholder = translations[lang][key];
                }
            });

            // Re-render list to show descriptions in correct lang
            renderCommands();
        }

        // --- Renderizado Principal ---
        function renderCommands() {
            resultsGrid.innerHTML = '';
            const t = translations[currentLang];
            
            const filtered = comandos.filter(item => {
                const matchesCategory = currentFilter === 'all' || item.categoria === currentFilter;
                
                // Determine description based on lang
                const desc = currentLang === 'en' && item.descripcion_en ? item.descripcion_en : item.descripcion;
                
                const term = normalizeText(searchTerm);
                const cmdText = normalizeText(item.comando);
                const descText = normalizeText(desc);
                const catText = normalizeText(item.categoria);
                
                const matchesSearch = !searchTerm || 
                                      cmdText.includes(term) || 
                                      descText.includes(term) ||
                                      catText.includes(term);

                return matchesCategory && matchesSearch;
            });

            // Update count text
            if (filtered.length === comandos.length) {
                resultCount.textContent = `${t.countAll} (${filtered.length})`;
            } else {
                resultCount.textContent = `${t.countFound} ${filtered.length} ${filtered.length !== 1 ? t.cmdsLabel : t.cmdLabel}`;
            }

            if (filtered.length === 0) {
                resultsGrid.innerHTML = `
                    <div class="empty-state">
                        <h3>${t.emptyTitle}</h3>
                        <p>${t.emptyDesc}</p>
                    </div>
                `;
                return;
            }

            const fragment = document.createDocumentFragment();
            filtered.forEach(item => {
                fragment.appendChild(createCardElement(item));
            });
            resultsGrid.appendChild(fragment);
        }

        function createCardElement(item, isAI = false, reason = null) {
            const card = document.createElement('div');
            card.className = isAI ? 'card ai-result' : 'card';
            const t = translations[currentLang];

            // Get correct description
            let description = currentLang === 'en' && item.descripcion_en ? item.descripcion_en : item.descripcion;

            // Highlight Logic
            const displayCmd = (!isAI && searchTerm) ? highlightText(item.comando, searchTerm) : item.comando;
            let displayDesc = (!isAI && searchTerm) ? highlightText(description, searchTerm) : description;

            // AI Logic
            if (isAI && reason) {
                displayDesc = `üí° <b>${t.aiStrategyLabel}</b> ${reason}`;
            }

            const badgeClass = isAI ? 'badge ai-badge' : 'badge';
            const badgeText = isAI ? t.aiRecommendedBadge : item.categoria;

            card.innerHTML = `
                <div class="card-header">
                    <span class="${badgeClass}">${badgeText}</span>
                </div>
                <div class="command-text">${displayCmd}</div>
                <div class="card-desc">${displayDesc}</div>
                <button class="copy-btn" onclick="copyToClipboard('${item.comando.replace(/'/g, "\\'")}')">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>
                    ${t.copyBtn}
                </button>
            `;
            return card;
        }

        // --- Utilidades de Texto ---
        function normalizeText(text) {
            if(!text) return "";
            return text.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        }

        function highlightText(text, term) {
            if (!term) return text;
            const regex = new RegExp(`(${term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            return text.replace(regex, '<span class="highlight-text">$1</span>');
        }

        // --- Manejadores de Eventos ---
        function handleSearch(e) {
            searchTerm = e.target.value;
            clearBtn.style.display = searchTerm.length > 0 ? 'block' : 'none';
            renderCommands();
        }

        function clearSearch() {
            searchTerm = '';
            searchInput.value = '';
            clearBtn.style.display = 'none';
            searchInput.focus();
            renderCommands();
        }

        function handleFilterClick(e) {
            if (e.target.classList.contains('filter-btn')) {
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                currentFilter = e.target.dataset.category;
                renderCommands();
            }
        }

        // --- Portapapeles ---
        window.copyToClipboard = function(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast();
            }).catch(err => {
                // Fallback
                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand("Copy");
                textArea.remove();
                showToast();
            });
        }

        function showToast() {
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // --- Tema ---
        function toggleTheme() {
            theme = theme === 'dark' ? 'light' : 'dark';
            applyTheme(theme);
            localStorage.setItem('theme', theme);
        }

        function applyTheme(selectedTheme) {
            document.documentElement.setAttribute('data-theme', selectedTheme);
            if (selectedTheme === 'dark') {
                iconSun.style.display = 'block';
                iconMoon.style.display = 'none';
            } else {
                iconSun.style.display = 'none';
                iconMoon.style.display = 'block';
            }
        }

        // =========================================
        // IA LOGIC (GEMINI)
        // =========================================
        function openModal() {
            aiModal.classList.add('open');
            aiPromptInput.focus();
        }

        function closeModal() {
            aiModal.classList.remove('open');
        }

        async function handleAIRequest() {
            const prompt = aiPromptInput.value.trim();
            if (!prompt) return;

            // UI Loading State
            loadingSpinner.style.display = 'block';
            const loadingText = loadingSpinner.querySelector('p');
            loadingText.textContent = translations[currentLang].aiLoading;
            
            aiResultsContainer.style.display = 'none';
            aiResultsContainer.innerHTML = '';
            aiSubmitBtn.disabled = true;

            try {
                // 1. Context Construction
                // We provide the list of available commands to the model (sending both descriptions for context)
                const commandListStr = JSON.stringify(comandos.map(c => ({
                    cmd: c.comando, 
                    desc: c.descripcion,
                    desc_en: c.descripcion_en
                })));
                
                const langInstruction = currentLang === 'en' 
                    ? "RESPOND IN ENGLISH. The user prompt is in English or Spanish." 
                    : "RESPONDE EN ESPA√ëOL. El prompt del usuario puede estar en ingl√©s o espa√±ol.";

                const systemPrompt = `
                    You are an expert in Bee Swarm Simulator and Natro Macro.
                    The user will describe a goal (e.g., farm honey, kill Vicious Bee).
                    Select relevant commands from this list: ${commandListStr}
                    
                    ${langInstruction}
                    
                    IMPORTANT:
                    1. Return ONLY valid JSON array.
                    2. Format: [{"comando": "exact command", "razon": "explanation in ${currentLang === 'en' ? 'English' : 'Spanish'}"}]
                    3. If user specifies a Field (e.g. Bamboo), replace (Field) in the command with "Bamboo".
                    4. No markdown, just raw JSON.
                `;

                // 2. API Call
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{ text: `User Goal: ${prompt}` }]
                        }],
                        systemInstruction: {
                            parts: [{ text: systemPrompt }]
                        },
                         generationConfig: {
                            responseMimeType: "application/json"
                        }
                    })
                });

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error.message);
                }

                const generatedText = data.candidates[0].content.parts[0].text;
                const recommendations = JSON.parse(generatedText);

                // 3. Render Results
                renderAIResults(recommendations);

            } catch (error) {
                console.error("AI Error:", error);
                const t = translations[currentLang];
                aiResultsContainer.innerHTML = `<p style="color: #ff6b6b; text-align: center;">${t.emptyDesc} <br><small>${error.message}</small></p>`;
                aiResultsContainer.style.display = 'block';
            } finally {
                loadingSpinner.style.display = 'none';
                aiSubmitBtn.disabled = false;
            }
        }

        function renderAIResults(recommendations) {
            const t = translations[currentLang];
            aiResultsContainer.innerHTML = `<h3 style="margin-bottom:15px; color: var(--accent);">${t.aiStrategyLabel}</h3>`;
            
            if (recommendations.length === 0) {
                aiResultsContainer.innerHTML += `<p>${t.emptyTitle}</p>`;
            }

            const fragment = document.createDocumentFragment();
            recommendations.forEach(rec => {
                // Create a dummy item object to reuse createCardElement
                const item = {
                    comando: rec.comando,
                    descripcion: rec.razon, // Fallback
                    descripcion_en: rec.razon, // Fallback
                    categoria: "IA"
                };
                fragment.appendChild(createCardElement(item, true, rec.razon));
            });
            
            aiResultsContainer.appendChild(fragment);
            aiResultsContainer.classList.add('has-results');
            aiResultsContainer.style.display = 'block';
        }

        // Iniciar App
        init();

    </script>
</body>
</html>
